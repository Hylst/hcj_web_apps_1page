<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Contrats pour Coachs Sportifs | Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            500: '#f59e0b',
                            600: '#d97706',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        
        .contract-section {
            background-color: white;
            border-left: 4px solid #0ea5e9;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        #contractPreview {
            min-height: 100vh;
            background-color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        
        .signature-pad-container {
            border: 1px dashed #cbd5e1;
            background-color: #f8fafc;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .signature-pad-container:hover {
            border-color: #0ea5e9;
        }
        
        .signature-pad {
            width: 100%;
            height: 100%;
        }
        
        .editor-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        
        .editor-input {
            @apply mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm p-2 border bg-white transition duration-150 ease-in-out;
        }
        
        .toggle-checkbox:checked {
            @apply right-0 border-primary-500;
            right: 0;
            border-color: #0ea5e9;
        }
        
        .toggle-checkbox:checked + .toggle-label {
            @apply bg-primary-500;
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        /* Style pour le contrat */
        .contract-title {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(90deg, #0ea5e9 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .signature-line {
            border-top: 1px solid #e5e7eb;
            width: 200px;
            margin-top: 60px;
        }
        
        .signature-timestamp {
            font-size: 0.7rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
        
        /* Animation pour les signatures */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .signature-animate {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* Style pour les onglets */
        .tab-button {
            @apply px-4 py-2 text-sm font-medium rounded-t-lg transition-colors duration-200;
        }
        
        .tab-button.active {
            @apply bg-white text-primary-600 border-b-2 border-primary-500;
        }
        
        .tab-button.inactive {
            @apply text-gray-500 hover:text-gray-700 hover:bg-gray-100;
        }
        
        /* Style pour le sélecteur de type de signature */
        .signature-type-selector {
            @apply flex items-center justify-center p-2 border rounded-lg cursor-pointer transition-colors duration-200;
        }
        
        .signature-type-selector.selected {
            @apply border-primary-500 bg-primary-50 text-primary-600;
        }
        
        .signature-type-selector:not(.selected) {
            @apply border-gray-300 hover:border-gray-400;
        }
        
        /* Style pour le logo upload */
        .logo-upload-container {
            @apply border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-primary-500 transition duration-150;
        }
        
        .logo-preview {
            @apply max-h-20 mx-auto;
        }
        
        /* Style amélioré pour le PDF */
        .pdf-header {
            @apply flex justify-between items-start mb-8;
        }
        
        .pdf-logo {
            @apply max-h-16;
        }
        
        .pdf-title {
            @apply text-2xl font-bold text-primary-700 mb-2;
        }
        
        .pdf-section-title {
            @apply text-lg font-semibold text-primary-700 mb-3 border-b border-primary-100 pb-2;
        }
        
        .pdf-clause-title {
            @apply font-semibold text-primary-700 mb-1;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8 text-center">
            <div class="inline-flex items-center bg-primary-100 text-primary-800 text-sm font-semibold px-4 py-2 rounded-full mb-4">
                <i class="fas fa-bolt mr-2"></i> VERSION PRO
            </div>
            <h1 class="text-4xl font-bold text-gray-900 mb-3">Générateur de Contrats Professionnels</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">Créez, personnalisez et exportez vos contrats de coaching en quelques minutes</p>
            <p class="text-sm text-gray-500 mt-4 flex items-center justify-center">
                <i class="fas fa-user-tie mr-2"></i> Créé par Geoffroy Streit
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Éditeur de contrat -->
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-cog mr-2 text-primary-500"></i> Paramètres
                        </h2>
                        <button onclick="resetForm()" class="text-sm text-gray-500 hover:text-primary-600 flex items-center">
                            <i class="fas fa-redo mr-1"></i> Réinitialiser
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="editor-label">Titre du contrat</label>
                            <input type="text" id="contractTitle" value="CONTRAT DE COACHING SPORTIF" class="editor-input">
                        </div>
                        
                        <div>
                            <label class="editor-label">Date du contrat</label>
                            <input type="date" id="contractDate" class="editor-input">
                        </div>
                        
                        <div>
                            <label class="editor-label">Référence du contrat</label>
                            <input type="text" id="contractReference" placeholder="Ex: CONTRACT-2023-001" class="editor-input">
                        </div>
                        
                        <div>
                            <label class="editor-label">Logo du coach (optionnel)</label>
                            <div id="logoUpload" class="logo-upload-container" onclick="document.getElementById('logoFile').click()">
                                <input type="file" id="logoFile" accept="image/*" class="hidden" onchange="handleLogoUpload(event)">
                                <div id="logoUploadContent">
                                    <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                    <p class="text-sm text-gray-600">Cliquez pour télécharger votre logo</p>
                                    <p class="text-xs text-gray-500 mt-1">Format recommandé : PNG ou JPG (max 500KB)</p>
                                </div>
                                <img id="logoPreview" class="logo-preview hidden">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center mb-4">
                        <i class="fas fa-users mr-2 text-primary-500"></i> Parties contractantes
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="bg-primary-50 p-3 rounded-lg">
                            <h3 class="text-sm font-medium text-primary-800 mb-2 flex items-center">
                                <i class="fas fa-dumbbell mr-1"></i> Coach Sportif
                            </h3>
                            <div>
                                <label class="editor-label">Nom complet</label>
                                <input type="text" id="coachName" class="editor-input" placeholder="Prénom et Nom">
                            </div>
                            
                            <div class="mt-3">
                                <label class="editor-label">Adresse</label>
                                <textarea id="coachAddress" rows="2" class="editor-input" placeholder="Adresse complète"></textarea>
                            </div>
                            
                            <div class="mt-3">
                                <label class="editor-label">Numéro SIRET</label>
                                <input type="text" id="coachSiret" class="editor-input" placeholder="Numéro SIRET">
                            </div>
                            
                            <div class="mt-3">
                                <label class="editor-label">Email</label>
                                <input type="email" id="coachEmail" class="editor-input" placeholder="contact@coach.com">
                            </div>
                            
                            <div class="mt-3">
                                <label class="editor-label">Téléphone</label>
                                <input type="tel" id="coachPhone" class="editor-input" placeholder="06 12 34 56 78">
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <h3 class="text-sm font-medium text-blue-800 mb-2 flex items-center">
                                <i class="fas fa-user mr-1"></i> Client
                            </h3>
                            <div>
                                <label class="editor-label">Nom complet</label>
                                <input type="text" id="clientName" class="editor-input" placeholder="Prénom et Nom">
                            </div>
                            
                            <div class="mt-3">
                                <label class="editor-label">Adresse</label>
                                <textarea id="clientAddress" rows="2" class="editor-input" placeholder="Adresse complète"></textarea>
                            </div>
                            
                            <div class="mt-3">
                                <label class="editor-label">Email</label>
                                <input type="email" id="clientEmail" class="editor-input" placeholder="client@email.com">
                            </div>
                            
                            <div class="mt-3">
                                <label class="editor-label">Téléphone</label>
                                <input type="tel" id="clientPhone" class="editor-input" placeholder="06 12 34 56 78">
                            </div>
                            
                            <div class="mt-3">
                                <label class="editor-label">Date de naissance</label>
                                <input type="date" id="clientBirthdate" class="editor-input">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center mb-4">
                        <i class="fas fa-running mr-2 text-primary-500"></i> Détails du coaching
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="editor-label">Type de coaching</label>
                            <select id="coachingType" class="editor-input">
                                <option value="Individuel">Individuel</option>
                                <option value="Collectif">Collectif</option>
                                <option value="En ligne">En ligne</option>
                                <option value="Personnalisé">Personnalisé</option>
                                <option value="Nutritionnel">Nutritionnel</option>
                                <option value="Préparation physique">Préparation physique</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="editor-label">Date de début</label>
                                <input type="date" id="startDate" class="editor-input">
                            </div>
                            <div>
                                <label class="editor-label">Date de fin</label>
                                <input type="date" id="endDate" class="editor-input">
                            </div>
                        </div>
                        
                        <div>
                            <label class="editor-label">Fréquence des séances</label>
                            <input type="text" id="sessionFrequency" class="editor-input" placeholder="Ex: 2 séances/semaine">
                        </div>
                        
                        <div>
                            <label class="editor-label">Durée des séances</label>
                            <input type="text" id="sessionDuration" class="editor-input" placeholder="Ex: 1 heure">
                        </div>
                        
                        <div>
                            <label class="editor-label">Lieu des séances</label>
                            <textarea id="sessionLocation" rows="2" class="editor-input" placeholder="Adresse ou lieu de rendez-vous"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="editor-label">Tarif</label>
                                <input type="text" id="coachingPrice" class="editor-input" placeholder="Ex: 50€/séance">
                            </div>
                            <div>
                                <label class="editor-label">Total estimé</label>
                                <input type="text" id="totalPrice" class="editor-input bg-gray-50" placeholder="Calcul automatique" readonly>
                            </div>
                        </div>
                        
                        <div>
                            <label class="editor-label">Mode de paiement</label>
                            <select id="paymentMethod" class="editor-input">
                                <option value="Virement bancaire">Virement bancaire</option>
                                <option value="Chèque">Chèque</option>
                                <option value="Espèces">Espèces</option>
                                <option value="Carte bancaire">Carte bancaire</option>
                                <option value="Prélèvement automatique">Prélèvement automatique</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center mb-4">
                        <i class="fas fa-file-contract mr-2 text-primary-500"></i> Clauses contractuelles
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="flex items-start justify-between">
                            <div>
                                <label for="includeCancellation" class="font-medium text-gray-700">Clause d'annulation</label>
                                <p class="text-xs text-gray-500">Délai d'annulation et conditions</p>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                <input type="checkbox" id="includeCancellation" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                <label for="includeCancellation" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                        
                        <div class="flex items-start justify-between">
                            <div>
                                <label for="includeLiability" class="font-medium text-gray-700">Clause de responsabilité</label>
                                <p class="text-xs text-gray-500">Engagement sur l'état de santé</p>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                <input type="checkbox" id="includeLiability" checked class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                <label for="includeLiability" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                        
                        <div class="flex items-start justify-between">
                            <div>
                                <label for="includeConfidentiality" class="font-medium text-gray-700">Clause de confidentialité</label>
                                <p class="text-xs text-gray-500">Protection des données personnelles</p>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                <input type="checkbox" id="includeConfidentiality" checked class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                <label for="includeConfidentiality" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                        
                        <div class="flex items-start justify-between">
                            <div>
                                <label for="includePaymentTerms" class="font-medium text-gray-700">Conditions de paiement</label>
                                <p class="text-xs text-gray-500">Délais et modalités</p>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                <input type="checkbox" id="includePaymentTerms" checked class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                <label for="includePaymentTerms" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                        
                        <div class="flex items-start justify-between">
                            <div>
                                <label for="includeHealthDeclaration" class="font-medium text-gray-700">Déclaration médicale</label>
                                <p class="text-xs text-gray-500">Certificat médical</p>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                <input type="checkbox" id="includeHealthDeclaration" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                <label for="includeHealthDeclaration" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                        
                        <div id="customClauseSection" class="hidden">
                            <label class="editor-label">Clause personnalisée</label>
                            <textarea id="customClause" rows="3" class="editor-input" placeholder="Rédigez votre clause spécifique..."></textarea>
                        </div>
                        
                        <button onclick="toggleCustomClause()" class="w-full text-sm text-primary-600 hover:text-primary-800 flex items-center justify-center mt-2">
                            <i class="fas fa-plus-circle mr-2"></i> Ajouter une clause personnalisée
                        </button>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center mb-4">
                        <i class="fas fa-signature mr-2 text-primary-500"></i> Signatures
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="editor-label mb-3">Type de signature</label>
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="signature-type-selector selected" onclick="selectSignatureType('handwritten', this)">
                                    <div class="flex flex-col items-center">
                                        <i class="fas fa-signature text-xl mb-1"></i>
                                        <span>Manuscrite</span>
                                    </div>
                                </div>
                                <div class="signature-type-selector" onclick="selectSignatureType('digital', this)">
                                    <div class="flex flex-col items-center">
                                        <i class="fas fa-font text-xl mb-1"></i>
                                        <span>Typographique</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="handwrittenSignatureSection">
                            <div class="mb-6">
                                <label class="editor-label">Signature du coach</label>
                                <div class="signature-pad-container mt-2 rounded-lg p-4">
                                    <canvas id="coachSignature" class="signature-pad" width="300" height="150"></canvas>
                                    <div class="flex justify-between mt-2">
                                        <button onclick="clearSignature('coachSignature')" class="text-sm text-gray-600 hover:text-primary-600 flex items-center">
                                            <i class="fas fa-eraser mr-1"></i> Effacer
                                        </button>
                                        <button onclick="saveSignature('coachSignature')" class="text-sm text-gray-600 hover:text-primary-600 flex items-center">
                                            <i class="fas fa-save mr-1"></i> Enregistrer
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="editor-label">Signature du client</label>
                                <div class="signature-pad-container mt-2 rounded-lg p-4">
                                    <canvas id="clientSignature" class="signature-pad" width="300" height="150"></canvas>
                                    <div class="flex justify-between mt-2">
                                        <button onclick="clearSignature('clientSignature')" class="text-sm text-gray-600 hover:text-primary-600 flex items-center">
                                            <i class="fas fa-eraser mr-1"></i> Effacer
                                        </button>
                                        <button onclick="saveSignature('clientSignature')" class="text-sm text-gray-600 hover:text-primary-600 flex items-center">
                                            <i class="fas fa-save mr-1"></i> Enregistrer
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="digitalSignatureSection" class="hidden">
                            <div class="mb-6">
                                <label class="editor-label">Signature numérique du coach</label>
                                <div class="flex items-center space-x-4 mt-2">
                                    <input type="text" id="digitalCoachSignature" class="editor-input flex-1" placeholder="Saisir le nom du coach">
                                    <button onclick="generateDigitalSignature('coach')" class="bg-primary-500 hover:bg-primary-600 text-white px-3 py-2 rounded-lg">
                                        <i class="fas fa-font"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <label class="editor-label">Signature numérique du client</label>
                                <div class="flex items-center space-x-4 mt-2">
                                    <input type="text" id="digitalClientSignature" class="editor-input flex-1" placeholder="Saisir le nom du client">
                                    <button onclick="generateDigitalSignature('client')" class="bg-primary-500 hover:bg-primary-600 text-white px-3 py-2 rounded-lg">
                                        <i class="fas fa-font"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="editor-label">Date de signature</label>
                            <input type="date" id="signatureDate" class="editor-input">
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" id="includeTimestamp" class="rounded text-primary-600 focus:ring-primary-500">
                            <label for="includeTimestamp" class="ml-2 text-sm text-gray-700">Inclure un horodatage des signatures</label>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4">
                    <button onclick="updateContract()" class="flex-1 bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-lg flex items-center justify-center transition duration-150 ease-in-out">
                        <i class="fas fa-sync-alt mr-2 animate-spin hidden" id="updateSpinner"></i>
                        <i class="fas fa-eye mr-2" id="updateIcon"></i> Prévisualiser
                    </button>
                    <button onclick="generatePDF()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg flex items-center justify-center transition duration-150 ease-in-out">
                        <i class="fas fa-file-pdf mr-2"></i> Exporter PDF
                    </button>
                </div>
                
                <div class="bg-white p-4 rounded-lg border border-gray-200 text-center">
                    <p class="text-sm text-gray-600">Besoin d'un modèle spécifique ?</p>
                    <button class="text-primary-600 hover:text-primary-800 text-sm font-medium mt-1">
                        Contactez-nous <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                </div>
            </div>

            <!-- Aperçu du contrat -->
            <div class="lg:col-span-2">
                <div class="sticky top-4">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-4 flex justify-between items-center">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-file-alt mr-2 text-primary-500"></i> Aperçu du contrat
                        </h2>
                        <div class="flex space-x-2">
                            <button onclick="printContract()" class="text-gray-600 hover:text-primary-600 flex items-center bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-lg text-sm transition duration-150 ease-in-out">
                                <i class="fas fa-print mr-1"></i> Imprimer
                            </button>
                            <button onclick="copyContractText()" class="text-gray-600 hover:text-primary-600 flex items-center bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-lg text-sm transition duration-150 ease-in-out">
                                <i class="fas fa-copy mr-1"></i> Copier
                            </button>
                            <button onclick="downloadContract()" class="text-gray-600 hover:text-primary-600 flex items-center bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-lg text-sm transition duration-150 ease-in-out">
                                <i class="fas fa-download mr-1"></i> Télécharger
                            </button>
                        </div>
                    </div>
                    
                    <div id="contractPreview" class="p-8">
                        <div class="max-w-4xl mx-auto">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold contract-title mb-2">CONTRAT DE COACHING SPORTIF</h1>
                                <p class="text-gray-600">Référence: <span id="previewReference">[N°REF]</span></p>
                            </div>
                            
                            <div class="text-center animate-pulse text-gray-500">
                                <i class="fas fa-file-contract text-4xl mb-2"></i>
                                <p>Prévisualisation du contrat</p>
                                <p class="text-sm mt-2">Remplissez le formulaire pour générer votre contrat</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-50 border-t border-gray-200 py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-600 mb-2">Générateur de Contrats Professionnels pour Coachs Sportifs</p>
            <p class="text-sm text-gray-500">© 2023 Créé par Geoffroy Streit. Tous droits réservés.</p>
            <div class="flex justify-center space-x-4 mt-4">
                <a href="#" class="text-gray-500 hover:text-primary-600"><i class="fab fa-twitter"></i></a>
                <a href="#" class="text-gray-500 hover:text-primary-600"><i class="fab fa-linkedin"></i></a>
                <a href="#" class="text-gray-500 hover:text-primary-600"><i class="fas fa-envelope"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // Variables globales
        let signatureType = 'handwritten';
        let coachSignaturePad, clientSignaturePad;
        let digitalCoachSignature = null;
        let digitalClientSignature = null;
        let coachLogo = null;
        
        // Initialisation du document
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('contractDate').value = today;
            document.getElementById('signatureDate').value = today;
            
            // Générer une référence aléatoire
            const randomRef = 'CONT-' + today.replace(/-/g, '') + '-' + Math.floor(1000 + Math.random() * 9000);
            document.getElementById('contractReference').value = randomRef;
            
            // Initialiser les pads de signature
            initSignaturePads();
            
            // Calculer la date de fin (3 mois après aujourd'hui)
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + 3);
            document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            
            // Écouteurs pour calcul automatique
            document.getElementById('sessionFrequency').addEventListener('input', calculateTotalPrice);
            document.getElementById('coachingPrice').addEventListener('input', calculateTotalPrice);
            document.getElementById('startDate').addEventListener('change', updateEndDate);
            document.getElementById('endDate').addEventListener('change', updateDuration);
            
            // Charger les signatures sauvegardées
            loadSavedSignatures();
            
            // Générer le contrat initial
            setTimeout(updateContract, 500);
        });
        
        // Gérer l'upload du logo
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Vérifier la taille du fichier (max 500KB)
            if (file.size > 500 * 1024) {
                showToast('Le fichier est trop volumineux (max 500KB)', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const logoPreview = document.getElementById('logoPreview');
                const logoUploadContent = document.getElementById('logoUploadContent');
                
                logoPreview.src = e.target.result;
                logoPreview.classList.remove('hidden');
                logoUploadContent.classList.add('hidden');
                
                // Stocker le logo pour le PDF
                coachLogo = e.target.result;
                
                showToast('Logo téléchargé avec succès', 'success');
                updateContract();
            };
            reader.readAsDataURL(file);
        }
        
        // Initialiser les pads de signature
        function initSignaturePads() {
            const coachCanvas = document.getElementById('coachSignature');
            const clientCanvas = document.getElementById('clientSignature');
            
            // Configurer les pads de signature
            coachSignaturePad = new SignaturePad(coachCanvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(30, 64, 175)',
                minWidth: 1,
                maxWidth: 2,
                throttle: 16
            });
            
            clientSignaturePad = new SignaturePad(clientCanvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(30, 64, 175)',
                minWidth: 1,
                maxWidth: 2,
                throttle: 16
            });
            
            // Redimensionner les canvas pour éviter le flou
            function resizeCanvas(canvas) {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext('2d').scale(ratio, ratio);
                canvas.style.width = '100%';
                canvas.style.height = '100%';
            }
            
            resizeCanvas(coachCanvas);
            resizeCanvas(clientCanvas);
            
            // Re-draw les signatures si elles existent
            loadSignature('coachSignature');
            loadSignature('clientSignature');
        }
        
        // Effacer une signature
        function clearSignature(canvasId) {
            if (canvasId === 'coachSignature') {
                coachSignaturePad.clear();
            } else {
                clientSignaturePad.clear();
            }
            localStorage.removeItem(canvasId);
        }
        
        // Enregistrer une signature
        function saveSignature(canvasId) {
            let signatureData;
            
            if (canvasId === 'coachSignature') {
                if (coachSignaturePad.isEmpty()) {
                    showToast('Veuillez signer avant d\'enregistrer', 'error');
                    return;
                }
                signatureData = coachSignaturePad.toDataURL();
            } else {
                if (clientSignaturePad.isEmpty()) {
                    showToast('Veuillez signer avant d\'enregistrer', 'error');
                    return;
                }
                signatureData = clientSignaturePad.toDataURL();
            }
            
            localStorage.setItem(canvasId, signatureData);
            showToast('Signature enregistrée avec succès', 'success');
        }
        
        // Charger une signature sauvegardée
        function loadSignature(canvasId) {
            const savedSignature = localStorage.getItem(canvasId);
            if (savedSignature) {
                if (canvasId === 'coachSignature') {
                    coachSignaturePad.fromDataURL(savedSignature);
                } else {
                    clientSignaturePad.fromDataURL(savedSignature);
                }
            }
        }
        
        // Charger toutes les signatures sauvegardées
        function loadSavedSignatures() {
            loadSignature('coachSignature');
            loadSignature('clientSignature');
            
            // Charger les signatures numériques si elles existent
            const savedDigitalCoach = localStorage.getItem('digitalCoachSignature');
            const savedDigitalClient = localStorage.getItem('digitalClientSignature');
            
            if (savedDigitalCoach) {
                digitalCoachSignature = savedDigitalCoach;
                document.getElementById('digitalCoachSignature').value = savedDigitalCoach;
            }
            
            if (savedDigitalClient) {
                digitalClientSignature = savedDigitalClient;
                document.getElementById('digitalClientSignature').value = savedDigitalClient;
            }
        }
        
        // Afficher une notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'
                    } mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Calculer le prix total estimé
        function calculateTotalPrice() {
            const frequency = document.getElementById('sessionFrequency').value;
            const price = document.getElementById('coachingPrice').value;
            
            // Extraction simple des nombres (pour démo)
            const freqNumber = frequency ? parseInt(frequency.match(/\d+/)?.[0] || '1') : 1;
            const priceNumber = price ? parseInt(price.match(/\d+/)?.[0] || '0') : 0;
            
            if (freqNumber && priceNumber) {
                // Estimation sur 3 mois (12 semaines)
                const total = freqNumber * 12 * priceNumber;
                document.getElementById('totalPrice').value = `${total}€ (estimation)`;
            }
        }
        
        // Mettre à jour la date de fin en fonction de la durée
        function updateEndDate() {
            const startDate = new Date(document.getElementById('startDate').value);
            if (!isNaN(startDate.getTime())) {
                const endDate = new Date(startDate);
                endDate.setMonth(endDate.getMonth() + 3);
                document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            }
        }
        
        // Mettre à jour la durée en fonction des dates
        function updateDuration() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            if (!isNaN(startDate.getTime()) && !isNaN(endDate.getTime())) {
                const diffTime = Math.abs(endDate - startDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const months = Math.floor(diffDays / 30);
                
                document.getElementById('contractDuration').value = `${months} mois (${diffDays} jours)`;
            }
        }
        
        // Basculer l'affichage de la clause personnalisée
        function toggleCustomClause() {
            const section = document.getElementById('customClauseSection');
            section.classList.toggle('hidden');
            
            const button = event.currentTarget;
            if (section.classList.contains('hidden')) {
                button.innerHTML = '<i class="fas fa-plus-circle mr-2"></i> Ajouter une clause personnalisée';
            } else {
                button.innerHTML = '<i class="fas fa-minus-circle mr-2"></i> Masquer la clause';
            }
        }
        
        // Sélectionner le type de signature
        function selectSignatureType(type, element) {
            signatureType = type;
            
            // Mettre à jour l'interface
            document.querySelectorAll('.signature-type-selector').forEach(el => {
                el.classList.remove('selected');
                el.classList.add('border-gray-300', 'hover:border-gray-400');
            });
            
            element.classList.add('selected');
            element.classList.remove('border-gray-300', 'hover:border-gray-400');
            
            // Afficher/masquer les sections appropriées
            if (type === 'handwritten') {
                document.getElementById('handwrittenSignatureSection').classList.remove('hidden');
                document.getElementById('digitalSignatureSection').classList.add('hidden');
            } else {
                document.getElementById('handwrittenSignatureSection').classList.add('hidden');
                document.getElementById('digitalSignatureSection').classList.remove('hidden');
            }
            
            updateContract();
        }
        
        // Générer une signature numérique
        function generateDigitalSignature(role) {
            const inputField = role === 'coach' ? 'digitalCoachSignature' : 'digitalClientSignature';
            const name = document.getElementById(inputField).value.trim();
            
            if (!name) {
                showToast('Veuillez entrer un nom', 'error');
                return;
            }
            
            // Créer un canvas pour la signature numérique
            const canvas = document.createElement('canvas');
            canvas.width = 300;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            
            // Style de la signature
            ctx.font = 'italic 24px "Brush Script MT", cursive';
            ctx.fillStyle = '#1e40af';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'center';
            
            // Dessiner le nom
            ctx.fillText(name, canvas.width / 2, canvas.height / 2);
            
            // Enregistrer la signature
            const signatureData = canvas.toDataURL();
            
            if (role === 'coach') {
                digitalCoachSignature = signatureData;
                localStorage.setItem('digitalCoachSignature', name);
            } else {
                digitalClientSignature = signatureData;
                localStorage.setItem('digitalClientSignature', name);
            }
            
            showToast('Signature numérique enregistrée', 'success');
            updateContract();
        }
        
        // Réinitialiser le formulaire
        function resetForm() {
            if (confirm('Êtes-vous sûr de vouloir réinitialiser tous les champs ?')) {
                document.querySelectorAll('input[type="text"], input[type="date"], input[type="email"], input[type="tel"], textarea').forEach(input => {
                    input.value = '';
                });
                
                // Effacer les signatures
                clearSignature('coachSignature');
                clearSignature('clientSignature');
                digitalCoachSignature = null;
                digitalClientSignature = null;
                document.getElementById('digitalCoachSignature').value = '';
                document.getElementById('digitalClientSignature').value = '';
                localStorage.removeItem('digitalCoachSignature');
                localStorage.removeItem('digitalClientSignature');
                
                // Réinitialiser le logo
                coachLogo = null;
                document.getElementById('logoPreview').src = '';
                document.getElementById('logoPreview').classList.add('hidden');
                document.getElementById('logoUploadContent').classList.remove('hidden');
                
                // Réinitialiser les valeurs par défaut
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('contractDate').value = today;
                document.getElementById('signatureDate').value = today;
                document.getElementById('contractTitle').value = 'CONTRAT DE COACHING SPORTIF';
                document.getElementById('coachingType').value = 'Individuel';
                document.getElementById('paymentMethod').value = 'Virement bancaire';
                document.getElementById('includeTimestamp').checked = false;
                
                // Sélectionner la signature manuscrite par défaut
                signatureType = 'handwritten';
                document.querySelectorAll('.signature-type-selector').forEach((el, index) => {
                    if (index === 0) {
                        el.classList.add('selected');
                        el.classList.remove('border-gray-300', 'hover:border-gray-400');
                    } else {
                        el.classList.remove('selected');
                        el.classList.add('border-gray-300', 'hover:border-gray-400');
                    }
                });
                document.getElementById('handwrittenSignatureSection').classList.remove('hidden');
                document.getElementById('digitalSignatureSection').classList.add('hidden');
                
                // Générer une nouvelle référence
                const randomRef = 'CONT-' + today.replace(/-/g, '') + '-' + Math.floor(1000 + Math.random() * 9000);
                document.getElementById('contractReference').value = randomRef;
                
                showToast('Formulaire réinitialisé avec succès', 'success');
                updateContract();
            }
        }
        
        // Mettre à jour l'aperçu du contrat
        function updateContract() {
            const contractPreview = document.getElementById('contractPreview');
            const updateSpinner = document.getElementById('updateSpinner');
            const updateIcon = document.getElementById('updateIcon');
            
            // Afficher l'indicateur de chargement
            updateSpinner.classList.remove('hidden');
            updateIcon.classList.add('hidden');
            
            // Simuler un délai pour l'animation
            setTimeout(() => {
                // Récupérer les valeurs des champs
                const contractTitle = document.getElementById('contractTitle').value || 'CONTRAT DE COACHING SPORTIF';
                const contractReference = document.getElementById('contractReference').value || '[N°REF]';
                const contractDate = document.getElementById('contractDate').value;
                const formattedDate = contractDate ? new Date(contractDate).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }) : '';
                const signatureDate = document.getElementById('signatureDate').value;
                const formattedSignatureDate = signatureDate ? new Date(signatureDate).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }) : '';
                const includeTimestamp = document.getElementById('includeTimestamp').checked;
                
                const coachName = document.getElementById('coachName').value || '[Nom du coach]';
                const coachAddress = document.getElementById('coachAddress').value || '[Adresse du coach]';
                const coachSiret = document.getElementById('coachSiret').value || '[SIRET]';
                const coachEmail = document.getElementById('coachEmail').value || '[Email]';
                const coachPhone = document.getElementById('coachPhone').value || '[Téléphone]';
                
                const clientName = document.getElementById('clientName').value || '[Nom du client]';
                const clientAddress = document.getElementById('clientAddress').value || '[Adresse du client]';
                const clientEmail = document.getElementById('clientEmail').value || '[Email]';
                const clientPhone = document.getElementById('clientPhone').value || '[Téléphone]';
                const clientBirthdate = document.getElementById('clientBirthdate').value;
                const formattedBirthdate = clientBirthdate ? new Date(clientBirthdate).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }) : '[Date de naissance]';
                
                const coachingType = document.getElementById('coachingType').value || '[Type de coaching]';
                const startDate = document.getElementById('startDate').value;
                const formattedStartDate = startDate ? new Date(startDate).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }) : '[Date de début]';
                const endDate = document.getElementById('endDate').value;
                const formattedEndDate = endDate ? new Date(endDate).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }) : '[Date de fin]';
                const sessionFrequency = document.getElementById('sessionFrequency').value || '[Fréquence]';
                const sessionDuration = document.getElementById('sessionDuration').value || '[Durée]';
                const contractDuration = document.getElementById('contractDuration').value || '[Durée]';
                const sessionLocation = document.getElementById('sessionLocation').value || '[Lieu]';
                const coachingPrice = document.getElementById('coachingPrice').value || '[Tarif]';
                const totalPrice = document.getElementById('totalPrice').value || '[Total]';
                const paymentMethod = document.getElementById('paymentMethod').value || '[Mode de paiement]';
                
                const includeCancellation = document.getElementById('includeCancellation').checked;
                const includeLiability = document.getElementById('includeLiability').checked;
                const includeConfidentiality = document.getElementById('includeConfidentiality').checked;
                const includePaymentTerms = document.getElementById('includePaymentTerms').checked;
                const includeHealthDeclaration = document.getElementById('includeHealthDeclaration').checked;
                const customClause = document.getElementById('customClause').value;
                
                // Générer le HTML du contrat
                contractPreview.innerHTML = `
                    <div class="max-w-4xl mx-auto font-serif text-gray-800">
                        <div class="pdf-header">
                            ${coachLogo ? `<img src="${coachLogo}" class="pdf-logo" alt="Logo du coach">` : '<div></div>'}
                            <div class="text-right">
                                <p class="text-gray-600">Référence: ${contractReference}</p>
                                <p class="text-sm text-gray-500">${formattedDate}</p>
                            </div>
                        </div>
                        
                        <div class="text-center mb-8">
                            <h1 class="pdf-title">${contractTitle}</h1>
                        </div>
                        
                        <div class="mb-8">
                            <h2 class="pdf-section-title">ENTRE LES SOUSSIGNÉS :</h2>
                            
                            <p class="mb-4"><strong>${coachName}</strong>, coach sportif, domicilié ${coachAddress},</p>
                            <p class="mb-4">immatriculé au registre du commerce et des sociétés sous le numéro ${coachSiret},</p>
                            <p class="mb-4">email: ${coachEmail}, téléphone: ${coachPhone},</p>
                            <p>ci-après dénommé "le Coach",</p>
                            
                            <p class="mt-8 mb-4">ET</p>
                            
                            <p class="mb-4"><strong>${clientName}</strong>, né(e) le ${formattedBirthdate},</p>
                            <p class="mb-4">domicilié ${clientAddress},</p>
                            <p class="mb-4">email: ${clientEmail}, téléphone: ${clientPhone},</p>
                            <p>ci-après dénommé "le Client",</p>
                        </div>
                        
                        <div class="mb-8">
                            <h2 class="pdf-section-title">IL A ÉTÉ CONVENU CE QUI SUIT :</h2>
                            
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article 1 - Objet</h3>
                                <p>Le présent contrat a pour objet de définir les conditions dans lesquelles le Coach s'engage à dispenser des séances de coaching sportif de type ${coachingType} au Client.</p>
                            </div>
                            
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article 2 - Durée</h3>
                                <p>Le présent contrat prend effet à compter du ${formattedStartDate} et se termine le ${formattedEndDate}, pour une durée totale de ${contractDuration}.</p>
                            </div>
                            
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article 3 - Modalités des séances</h3>
                                <p>Les séances auront lieu avec une fréquence de ${sessionFrequency}, d'une durée de ${sessionDuration} chacune.</p>
                                <p class="mt-2">Le lieu des séances est fixé à : ${sessionLocation}.</p>
                            </div>
                            
                            ${includePaymentTerms ? `
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article ${includeCancellation ? '5' : '4'} - Tarifs et paiement</h3>
                                <p>Le prix des séances est fixé à ${coachingPrice}, pour un total estimé de ${totalPrice}.</p>
                                <p class="mt-2">Le paiement s'effectue par ${paymentMethod}.</p>
                                <p class="mt-2">Tout retard de paiement pourra donner lieu à l'application d'intérêts de retard au taux légal.</p>
                            </div>
                            ` : ''}
                            
                            ${includeCancellation ? `
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article ${includePaymentTerms ? '5' : '4'} - Annulation</h3>
                                <p>Toute séance annulée moins de 24 heures à l'avance sera due. Le Coach se réserve le droit d'annuler ou de reporter une séance en cas de force majeure, avec un préavis de 24 heures dans la mesure du possible.</p>
                            </div>
                            ` : ''}
                            
                            ${includeLiability ? `
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article ${(includePaymentTerms ? 1 : 0) + (includeCancellation ? 1 : 0) + 4} - Responsabilité</h3>
                                <p>Le Client déclare être en bonne santé et apte à pratiquer une activité physique. Le Coach déclare être qualifié pour dispenser des séances de coaching sportif. Le Client reste seul responsable de son état de santé et s'engage à informer le Coach de toute contre-indication médicale.</p>
                            </div>
                            ` : ''}
                            
                            ${includeHealthDeclaration ? `
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article ${(includePaymentTerms ? 1 : 0) + (includeCancellation ? 1 : 0) + (includeLiability ? 1 : 0) + 4} - Déclaration médicale</h3>
                                <p>Le Client certifie avoir fourni un certificat médical de non contre-indication à la pratique du sport datant de moins d'un an. En cas de modification de son état de santé, le Client s'engage à fournir un nouveau certificat médical.</p>
                            </div>
                            ` : ''}
                            
                            ${includeConfidentiality ? `
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article ${(includePaymentTerms ? 1 : 0) + (includeCancellation ? 1 : 0) + (includeLiability ? 1 : 0) + (includeHealthDeclaration ? 1 : 0) + 4} - Confidentialité</h3>
                                <p>Les parties s'engage à garder confidentielles toutes les informations échangées dans le cadre de ce contrat, à l'exception des informations nécessaires à la bonne exécution des séances de coaching.</p>
                            </div>
                            ` : ''}
                            
                            ${customClause ? `
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article ${(includePaymentTerms ? 1 : 0) + (includeCancellation ? 1 : 0) + (includeLiability ? 1 : 0) + (includeHealthDeclaration ? 1 : 0) + (includeConfidentiality ? 1 : 0) + 4} - Clause personnalisée</h3>
                                <p>${customClause.replace(/\n/g, '<br>')}</p>
                            </div>
                            ` : ''}
                            
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article ${(includePaymentTerms ? 1 : 0) + (includeCancellation ? 1 : 0) + (includeLiability ? 1 : 0) + (includeHealthDeclaration ? 1 : 0) + (includeConfidentiality ? 1 : 0) + (customClause ? 1 : 0) + 4} - Résiliation</h3>
                                <p>Le présent contrat peut être résilié par l'une ou l'autre des parties moyennant un préavis de 15 jours. En cas de résiliation par le Client, les séances déjà payées et non effectuées seront remboursées au prorata temporis.</p>
                            </div>
                            
                            <div class="contract-section p-4 mb-4">
                                <h3 class="pdf-clause-title">Article ${(includePaymentTerms ? 1 : 0) + (includeCancellation ? 1 : 0) + (includeLiability ? 1 : 0) + (includeHealthDeclaration ? 1 : 0) + (includeConfidentiality ? 1 : 0) + (customClause ? 1 : 0) + 5} - Loi applicable et juridiction compétente</h3>
                                <p>Le présent contrat est soumis à la loi française. En cas de litige, les parties s'efforceront de trouver une solution amiable. À défaut, les tribunaux compétents seront ceux du lieu du siège social du Coach.</p>
                            </div>
                        </div>
                        
                        <div class="mt-12">
                            <p class="mb-8">Fait en deux exemplaires originaux, à ${coachAddress.split(',')[0] || '[Ville]'}, le ${formattedSignatureDate}.</p>
                            
                            <div class="grid grid-cols-2 gap-8">
                                <div>
                                    <p class="font-semibold mb-2">Pour le Client :</p>
                                    <div class="signature-placeholder mb-2" style="height: 80px;">
                                        ${signatureType === 'handwritten' ? 
                                            `<img id="clientSignatureImg" class="h-full signature-animate" src="">` : 
                                            `<div id="digitalClientSignaturePreview" class="flex items-center justify-center h-full signature-animate" style="font-family: 'Brush Script MT', cursive; font-size: 24px; font-style: italic; color: #1e40af;">${clientName}</div>`
                                        }
                                    </div>
                                    <p>${clientName}</p>
                                    ${includeTimestamp ? `<p class="signature-timestamp">Signé électroniquement le ${new Date().toLocaleString('fr-FR')}</p>` : ''}
                                </div>
                                
                                <div>
                                    <p class="font-semibold mb-2">Pour le Coach :</p>
                                    <div class="signature-placeholder mb-2" style="height: 80px;">
                                        ${signatureType === 'handwritten' ? 
                                            `<img id="coachSignatureImg" class="h-full signature-animate" src="">` : 
                                            `<div id="digitalCoachSignaturePreview" class="flex items-center justify-center h-full signature-animate" style="font-family: 'Brush Script MT', cursive; font-size: 24px; font-style: italic; color: #1e40af;">${coachName}</div>`
                                        }
                                    </div>
                                    <p>${coachName}</p>
                                    ${includeTimestamp ? `<p class="signature-timestamp">Signé électroniquement le ${new Date().toLocaleString('fr-FR')}</p>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Mettre à jour les signatures dans l'aperçu
                if (signatureType === 'handwritten') {
                    updateSignaturePreview('coachSignature', 'coachSignatureImg');
                    updateSignaturePreview('clientSignature', 'clientSignatureImg');
                }
                
                // Masquer l'indicateur de chargement
                updateSpinner.classList.add('hidden');
                updateIcon.classList.remove('hidden');
            }, 500);
        }
        
        // Mettre à jour l'aperçu des signatures manuscrites
        function updateSignaturePreview(canvasId, imgId) {
            let signatureData;
            
            if (canvasId === 'coachSignature') {
                signatureData = coachSignaturePad.toDataURL();
            } else {
                signatureData = clientSignaturePad.toDataURL();
            }
            
            const imgElement = document.getElementById(imgId);
            if (imgElement && signatureData !== 'data:,') {
                imgElement.src = signatureData;
            }
        }
        
        // Générer un PDF
        function generatePDF() {
            updateContract(); // Mettre à jour l'aperçu avant la génération
            
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('contractPreview');
            
            // Afficher un indicateur de génération
            showToast('Génération du PDF en cours...', 'info');
            
            html2canvas(element, {
                scale: 2,
                logging: false,
                useCORS: true,
                allowTaint: true,
                scrollX: 0,
                scrollY: 0,
                windowWidth: element.scrollWidth,
                windowHeight: element.scrollHeight
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                
                // Ajouter un pied de page
                const pageCount = pdf.internal.getNumberOfPages();
                for(let i = 1; i <= pageCount; i++) {
                    pdf.setPage(i);
                    pdf.setFontSize(10);
                    pdf.setTextColor(150);
                    pdf.text(`Page ${i} sur ${pageCount} - Contrat généré avec CoachContract Pro`, pdfWidth - 15, pdf.internal.pageSize.getHeight() - 10, {align: 'right'});
                }
                
                pdf.save(`Contrat_Coaching_${document.getElementById('clientName').value || 'Client'}.pdf`);
                showToast('PDF généré avec succès', 'success');
            }).catch(err => {
                console.error(err);
                showToast('Erreur lors de la génération du PDF', 'error');
            });
        }
        
        // Imprimer le contrat
        function printContract() {
            updateContract(); // Mettre à jour l'aperçu avant l'impression
            
            setTimeout(() => {
                const printContent = document.getElementById('contractPreview').innerHTML;
                const originalContent = document.body.innerHTML;
                
                document.body.innerHTML = printContent;
                window.print();
                document.body.innerHTML = originalContent;
                
                // Recharger la page pour restaurer les fonctionnalités
                window.location.reload();
            }, 500);
        }
        
        // Copier le texte du contrat
        function copyContractText() {
            updateContract(); // Mettre à jour l'aperçu avant la copie
            
            setTimeout(() => {
                const contractText = document.getElementById('contractPreview').innerText;
                navigator.clipboard.writeText(contractText).then(() => {
                    showToast('Texte du contrat copié dans le presse-papiers', 'success');
                }).catch(err => {
                    showToast('Erreur lors de la copie du texte', 'error');
                });
            }, 500);
        }
        
        // Télécharger le contrat au format HTML
        function downloadContract() {
            updateContract(); // Mettre à jour l'aperçu avant le téléchargement
            
            setTimeout(() => {
                const contractContent = document.getElementById('contractPreview').outerHTML;
                const blob = new Blob([contractContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `Contrat_Coaching_${document.getElementById('clientName').value || 'Client'}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Contrat téléchargé au format HTML', 'success');
            }, 500);
        }
    </script>
</body>
</html>